stage('Run Docker Compose') {
  steps {
    echo 'ðŸš€ docker compose up'
    withEnv([
      "COMPOSE_PROJECT_NAME=jenkinsdockerpipeline",  // atau "jenkins_${BUILD_NUMBER}"
      "DB_PORT=13307",
      "PHPMYADMIN_PORT=18082"
    ]) {
      bat '''
        REM bersihkan container yang mungkin pegang port kita
        for /f "tokens=1" %%i in ('docker ps -aq --filter "publish=13307"') do docker rm -f %%i
        for /f "tokens=1" %%i in ('docker ps -aq --filter "publish=18082"') do docker rm -f %%i

        docker compose down --remove-orphans
        docker compose up -d --build
      '''
    }
  }
}
